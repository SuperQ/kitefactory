---
- name: Determine os type
  shell: uname
  register: os_type

- name: Determine arch
  shell: uname -m
  register: arch

- name: Normalize to Go names
  set_fact:
    os_type: "{{ os_type.stdout|lower }}"
    arch: "{{ arch.stdout|lower }}"

- set_fact:
    platform: "{{ lookup('env','PACKER_TEMPLATE') | regex_replace('[^a-zA-Z0-9-]', '-') }}"

- set_fact:
    hostname: "{{ platform }}.build.prometheus.io"

# This is a common way for all platforms to bootstrap servies
- lineinfile:
    dest: /etc/rc.local
    create: yes
    owner: root
    group: "{{ root_group }}"
    mode: 0775
    regexp: '^[#][!]'
    line: '#!/bin/sh'
    insertbefore: BOF
